{% extends "base.html" %}

{% block title %}Add Transaction - Finance Tracker{% endblock %}

{% block content %}
<div class="add-transaction-page">
    <h1>Add New Transaction</h1>
    
    <div class="form-container">
        <form id="addTransactionForm" class="transaction-form">
            <div class="form-group">
                <label for="type">Transaction Type *</label>
                <select id="type" name="type" required>
                    <option value="">-- Select Type --</option>
                    <option value="income">Income</option>
                    <option value="expense">Expense</option>
                </select>
            </div>

            <div class="form-group">
                <label for="category">Category *</label>
                <input type="text" id="category" name="category" placeholder="e.g., Food, Salary, Rent" required>
            </div>

            <div class="form-group">
                <label for="amount">Amount (Ksh) *</label>
                <input type="number" id="amount" name="amount" placeholder="0.00" step="0.01" min="0" required>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">✅ Add Transaction</button>
                <a href="{{ url_for('index') }}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>

        <div id="formMessage" class="form-message" style="display: none;"></div>
    </div>
</div>

<script>
document.getElementById('addTransactionForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = {
        type: document.getElementById('type').value,
        category: document.getElementById('category').value,
        amount: document.getElementById('amount').value
    };

    try {
        const response = await fetch('{{ url_for("api_add_transaction") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });

        const data = await response.json();
        const messageDiv = document.getElementById('formMessage');

        if (data.success) {
            messageDiv.className = 'form-message success';
            messageDiv.textContent = '✅ ' + data.message;
            messageDiv.style.display = 'block';
            document.getElementById('addTransactionForm').reset();
            
            setTimeout(() => {
                window.location.href = '{{ url_for("index") }}';
            }, 1500);
        } else {
            messageDiv.className = 'form-message error';
            messageDiv.textContent = '❌ ' + data.message;
            messageDiv.style.display = 'block';
        }
    } catch (error) {
        document.getElementById('formMessage').className = 'form-message error';
        document.getElementById('formMessage').textContent = '❌ Error: ' + error.message;
        document.getElementById('formMessage').style.display = 'block';
    }
});
</script>
{% endblock %}
